<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Meus Pedidos - Barat√£o Assados</title>
    <link rel="stylesheet" href="style_pedidos.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="background-animation"></div>

    <section class="principal">
      <!-- Header com Logo e Navega√ß√£o -->
      <div class="header-section">
        <div class="logo-container">
          <div class="logo-icon">
            <i class="fas fa-fire"></i>
          </div>
          <div class="logo-text">
            <h1>Meus Pedidos</h1>
            <p class="logo-subtitle">Acompanhe seu hist√≥rico</p>
          </div>
        </div>

        <div class="header-actions">
          <button
            class="btn-back"
            data-action="navigate-back"
            aria-label="Voltar √† p√°gina inicial"
          >
            <i class="fas fa-arrow-left"></i>
            <span>Voltar</span>
          </button>
        </div>
      </div>

      <!-- Status do Usu√°rio -->
      <div class="user-status-card">
        <div class="user-info">
          <div class="user-avatar">
            <i class="fas fa-user"></i>
          </div>
          <div class="user-details">
            <h3 id="userName">Jo√£o Silva</h3>
            <p id="userEmail">joao@email.com</p>
          </div>
        </div>
        <div class="user-stats">
          <div class="stat-item">
            <span class="stat-number" id="totalOrders">0</span>
            <span class="stat-label">Pedidos</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="totalSpent">R$ 0,00</span>
            <span class="stat-label">Gasto Total</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="averageOrder">R$ 0,00</span>
            <span class="stat-label">Ticket M√©dio</span>
          </div>
        </div>
      </div>

      <!-- Filtros e Busca -->
      <div class="orders-filter-section">
        <div class="filter-header">
          <h3><i class="fas fa-filter"></i> Filtrar Pedidos</h3>
        </div>

        <div class="filters-container">
          <!-- Abas de Status -->
          <div class="status-tabs">
            <button class="status-tab active" data-filter="all">
              <i class="fas fa-list"></i>
              <span>Todos</span>
              <span class="tab-count" id="countAll">0</span>
            </button>
            <button class="status-tab" data-filter="pending">
              <i class="fas fa-clock"></i>
              <span>Pendentes</span>
              <span class="tab-count" id="countPending">0</span>
            </button>
            <button class="status-tab" data-filter="confirmed">
              <i class="fas fa-check-circle"></i>
              <span>Confirmados</span>
              <span class="tab-count" id="countConfirmed">0</span>
            </button>
            <button class="status-tab" data-filter="delivered">
              <i class="fas fa-truck"></i>
              <span>Entregues</span>
              <span class="tab-count" id="countDelivered">0</span>
            </button>
            <button class="status-tab" data-filter="cancelled">
              <i class="fas fa-times-circle"></i>
              <span>Cancelados</span>
              <span class="tab-count" id="countCancelled">0</span>
            </button>
          </div>

          <!-- Busca e Ordena√ß√£o -->
          <div class="search-sort-container">
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input
                type="text"
                id="searchInput"
                class="search-input"
                placeholder="Buscar por n√∫mero do pedido..."
                aria-label="Buscar pedidos"
              />
            </div>

            <select
              id="sortSelect"
              class="sort-select"
              aria-label="Ordenar pedidos"
            >
              <option value="recent">Mais Recentes</option>
              <option value="oldest">Mais Antigos</option>
              <option value="highest">Maior Valor</option>
              <option value="lowest">Menor Valor</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Lista de Pedidos -->
      <div class="orders-container">
        <div class="orders-list" id="ordersList">
          <!-- Pedidos ser√£o carregados dinamicamente -->
          <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <h3>Nenhum pedido encontrado</h3>
            <p>Voc√™ ainda n√£o fez nenhum pedido. Que tal come√ßar agora?</p>
            <button class="btn-card" data-action="go-to-menu">
              <i class="fas fa-utensils"></i>
              Ver Card√°pio
            </button>
          </div>
        </div>
      </div>

      <!-- Modal de Detalhes do Pedido -->
      <div
        id="modalOrderDetails"
        class="modal"
        role="dialog"
        aria-labelledby="modal-order-title"
        aria-hidden="true"
      >
        <div class="modal-content modal-large">
          <div class="modal-header">
            <h2 id="modal-order-title">Detalhes do Pedido</h2>
            <button
              class="close-btn"
              data-action="close-order-modal"
              aria-label="Fechar modal"
            >
              &times;
            </button>
          </div>
          <div class="modal-body">
            <div class="order-details-content" id="orderDetailsContent">
              <!-- Conte√∫do ser√° preenchido dinamicamente -->
            </div>
          </div>
        </div>
      </div>

      <!-- Se√ß√£o de Contatos -->
      <div class="contatos-section">
        <p class="contatos-title">Onde nos encontrar</p>
        <div class="contatos">
          <a
            href="https://www.instagram.com/barataoassados/"
            target="_blank"
            rel="noopener"
            class="social-link instagram"
            aria-label="Instagram"
          >
            <i class="fab fa-instagram"></i>
            <span>Instagram</span>
          </a>
          <a
            href="https://wa.me/5500000000000"
            target="_blank"
            rel="noopener"
            class="social-link whatsapp"
            aria-label="WhatsApp"
          >
            <i class="fab fa-whatsapp"></i>
            <span>WhatsApp</span>
          </a>
          <a
            href="https://wa.me/5500000000000"
            target="_blank"
            rel="noopener"
            class="social-link location"
            aria-label="Localiza√ß√£o"
          >
            <i class="fas fa-map-marker-alt"></i>
            <span>Localiza√ß√£o</span>
          </a>
        </div>
      </div>
    </section>

    <!-- √Årea de notifica√ß√µes -->
    <div
      id="notificationArea"
      class="notification-area"
      aria-live="polite"
    ></div>

    <script>
      /**
       * Sistema de Meus Pedidos - Barat√£o Assados
       * Arquitetura: Module Pattern + Observer Pattern
       * Desenvolvido com ES6+ e princ√≠pios SOLID
       */

      "use strict";

      // ==================== M√ìDULO DE DADOS ====================
      const DataModule = (() => {
        const CONFIG = {
          ANIMATION_DURATION: 3000,
          ITEMS_PER_PAGE: 10,
        };

        // Dados simulados de pedidos
        const MOCK_ORDERS = [
          {
            id: "#PED-001",
            date: "2024-12-02",
            time: "14:30",
            status: "delivered",
            statusLabel: "Entregue",
            total: 125.9,
            items: [
              { name: "Picanha Assada 750g", quantity: 2, price: 50.0 },
              { name: "Farofa Completa", quantity: 1, price: 12.9 },
              { name: "Refrigerante Lata", quantity: 2, price: 5.9 },
            ],
            deliveryType: "Retirada",
            deliveryAddress: "Loja F√≠sica",
            paymentMethod: "Dinheiro",
            notes: "Pedido entregue conforme solicitado",
          },
          {
            id: "#PED-002",
            date: "2024-12-01",
            time: "18:45",
            status: "confirmed",
            statusLabel: "Confirmado",
            total: 89.5,
            items: [
              { name: "Frango Inteiro Assado", quantity: 1, price: 28.9 },
              { name: "Vinagrete Tradicional", quantity: 1, price: 8.9 },
              { name: "Suco Natural", quantity: 2, price: 12.9 },
            ],
            deliveryType: "Delivery",
            deliveryAddress: "Rua das Flores, 123 - Apto 45",
            paymentMethod: "PIX",
            notes: "Saindo para entrega agora",
          },
          {
            id: "#PED-003",
            date: "2024-11-30",
            time: "12:00",
            status: "pending",
            statusLabel: "Pendente",
            total: 156.8,
            items: [
              { name: "Alcatra Assada 1000g", quantity: 1, price: 65.9 },
              { name: "Costela Assada", quantity: 1, price: 48.9 },
              { name: "P√£o de Alho", quantity: 2, price: 9.9 },
            ],
            deliveryType: "Retirada",
            deliveryAddress: "Loja F√≠sica",
            paymentMethod: "Cart√£o",
            notes: "Aguardando confirma√ß√£o de pagamento",
          },
          {
            id: "#PED-004",
            date: "2024-11-28",
            time: "19:20",
            status: "delivered",
            statusLabel: "Entregue",
            total: 98.7,
            items: [
              { name: "Til√°pia Grelhada", quantity: 1, price: 34.9 },
              { name: "Mandioca Frita", quantity: 1, price: 11.9 },
              { name: "Cerveja Long Neck", quantity: 3, price: 8.9 },
            ],
            deliveryType: "Delivery",
            deliveryAddress: "Rua Principal, 456",
            paymentMethod: "Dinheiro",
            notes: "Entregue com sucesso",
          },
          {
            id: "#PED-005",
            date: "2024-11-25",
            time: "13:15",
            status: "cancelled",
            statusLabel: "Cancelado",
            total: 75.5,
            items: [
              { name: "Contrafil√©", quantity: 1, price: 42.9 },
              { name: "√Ågua Mineral", quantity: 2, price: 3.9 },
            ],
            deliveryType: "Retirada",
            deliveryAddress: "Loja F√≠sica",
            paymentMethod: "PIX",
            notes: "Cancelado pelo cliente",
          },
        ];

        return {
          CONFIG,
          MOCK_ORDERS,

          /**
           * Obt√©m todos os pedidos
           * @returns {Array} Array de pedidos
           */
          getAllOrders: () => [...MOCK_ORDERS],

          /**
           * Filtra pedidos por status
           * @param {string} status - Status do pedido
           * @returns {Array} Pedidos filtrados
           */
          getOrdersByStatus: (status) => {
            if (status === "all") return [...MOCK_ORDERS];
            return MOCK_ORDERS.filter((order) => order.status === status);
          },

          /**
           * Busca pedidos por n√∫mero
           * @param {string} query - N√∫mero do pedido
           * @returns {Array} Pedidos encontrados
           */
          searchOrders: (query) => {
            const lowerQuery = query.toLowerCase();
            return MOCK_ORDERS.filter((order) =>
              order.id.toLowerCase().includes(lowerQuery)
            );
          },

          /**
           * Conta pedidos por status
           * @returns {Object} Contagem por status
           */
          countByStatus: () => {
            return {
              all: MOCK_ORDERS.length,
              pending: MOCK_ORDERS.filter((o) => o.status === "pending").length,
              confirmed: MOCK_ORDERS.filter((o) => o.status === "confirmed")
                .length,
              delivered: MOCK_ORDERS.filter((o) => o.status === "delivered")
                .length,
              cancelled: MOCK_ORDERS.filter((o) => o.status === "cancelled")
                .length,
            };
          },

          /**
           * Calcula estat√≠sticas do usu√°rio
           * @returns {Object} Estat√≠sticas
           */
          calculateStats: () => {
            const deliveredOrders = MOCK_ORDERS.filter(
              (o) => o.status === "delivered"
            );
            const totalSpent = deliveredOrders.reduce(
              (sum, order) => sum + order.total,
              0
            );
            const averageOrder =
              deliveredOrders.length > 0
                ? totalSpent / deliveredOrders.length
                : 0;

            return {
              totalOrders: MOCK_ORDERS.length,
              totalSpent,
              averageOrder,
            };
          },
        };
      })();

      // ==================== M√ìDULO DE UTILIT√ÅRIOS ====================
      const UtilsModule = (() => {
        "use strict";

        /**
         * Formata valores monet√°rios para o padr√£o brasileiro
         * @param {number} value - Valor a ser formatado
         * @returns {string} Valor formatado
         */
        const formatCurrency = (value) => {
          return `R$ ${value.toFixed(2).replace(".", ",")}`;
        };

        /**
         * Formata data para o padr√£o brasileiro
         * @param {string} dateString - Data em formato ISO
         * @returns {string} Data formatada
         */
        const formatDate = (dateString) => {
          const date = new Date(dateString + "T00:00:00");
          return date.toLocaleDateString("pt-BR", {
            day: "2-digit",
            month: "2-digit",
            year: "numeric",
          });
        };

        /**
         * Sanitiza entrada de texto para evitar XSS
         * @param {string} text - Texto a ser sanitizado
         * @returns {string} Texto seguro
         */
        const sanitizeText = (text) => {
          const div = document.createElement("div");
          div.textContent = text;
          return div.innerHTML;
        };

        /**
         * Obt√©m elemento do DOM com valida√ß√£o
         * @param {string} selector - Seletor CSS
         * @returns {Element|null} Elemento ou null
         */
        const getElement = (selector) => {
          const element = document.querySelector(selector);
          if (!element) {
            console.warn(`Elemento n√£o encontrado: ${selector}`);
          }
          return element;
        };

        /**
         * Cria elemento DOM com atributos
         * @param {string} tag - Tag HTML
         * @param {Object} attributes - Atributos do elemento
         * @param {string} content - Conte√∫do interno
         * @returns {Element} Elemento criado
         */
        const createElement = (tag, attributes = {}, content = "") => {
          const element = document.createElement(tag);

          Object.entries(attributes).forEach(([key, value]) => {
            if (key === "className") {
              element.className = value;
            } else if (key === "dataset") {
              Object.entries(value).forEach(([dataKey, dataValue]) => {
                element.dataset[dataKey] = dataValue;
              });
            } else {
              element.setAttribute(key, value);
            }
          });

          if (content) {
            element.innerHTML = content;
          }

          return element;
        };

        /**
         * Debounce para otimizar performance
         * @param {Function} func - Fun√ß√£o a ser executada
         * @param {number} wait - Tempo de espera em ms
         * @returns {Function} Fun√ß√£o com debounce
         */
        const debounce = (func, wait) => {
          let timeout;
          return function executedFunction(...args) {
            const later = () => {
              clearTimeout(timeout);
              func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
          };
        };

        // API p√∫blica
        return {
          formatCurrency,
          formatDate,
          sanitizeText,
          getElement,
          createElement,
          debounce,
        };
      })();

      // ==================== M√ìDULO DE NOTIFICA√á√ïES ====================
      const NotificationModule = (() => {
        "use strict";

        const NOTIFICATION_TYPES = {
          SUCCESS: "success",
          ERROR: "error",
          INFO: "info",
          WARNING: "warning",
        };

        /**
         * Exibe notifica√ß√£o para o usu√°rio
         * @param {string} message - Mensagem a ser exibida
         * @param {string} type - Tipo da notifica√ß√£o
         * @param {number} duration - Dura√ß√£o em ms
         */
        const show = (
          message,
          type = NOTIFICATION_TYPES.INFO,
          duration = 3000
        ) => {
          const notificationArea = UtilsModule.getElement("#notificationArea");
          if (!notificationArea) return;

          const notification = UtilsModule.createElement(
            "div",
            {
              className: `notification notification--${type}`,
              "aria-live": "polite",
            },
            `
            <div class="notification__content">
                <i class="notification__icon ${getIconForType(type)}"></i>
                <span class="notification__message">${UtilsModule.sanitizeText(
                  message
                )}</span>
            </div>
        `
          );

          notificationArea.appendChild(notification);

          // Auto remo√ß√£o
          setTimeout(() => {
            notification.classList.add("notification--removing");
            setTimeout(() => notification.remove(), 300);
          }, duration);
        };

        /**
         * Obt√©m √≠cone apropriado para o tipo de notifica√ß√£o
         * @param {string} type - Tipo da notifica√ß√£o
         * @returns {string} Classe do √≠cone
         */
        const getIconForType = (type) => {
          const icons = {
            [NOTIFICATION_TYPES.SUCCESS]: "fas fa-check-circle",
            [NOTIFICATION_TYPES.ERROR]: "fas fa-exclamation-circle",
            [NOTIFICATION_TYPES.INFO]: "fas fa-info-circle",
            [NOTIFICATION_TYPES.WARNING]: "fas fa-exclamation-triangle",
          };
          return icons[type] || icons[NOTIFICATION_TYPES.INFO];
        };

        // M√©todos de conveni√™ncia
        return {
          show,
          success: (message, duration) =>
            show(message, NOTIFICATION_TYPES.SUCCESS, duration),
          error: (message, duration) =>
            show(message, NOTIFICATION_TYPES.ERROR, duration),
          info: (message, duration) =>
            show(message, NOTIFICATION_TYPES.INFO, duration),
          warning: (message, duration) =>
            show(message, NOTIFICATION_TYPES.WARNING, duration),
          TYPES: NOTIFICATION_TYPES,
        };
      })();

      // ==================== M√ìDULO DE UI ====================
      const UIModule = (() => {
        "use strict";

        let currentFilter = "all";
        let currentSort = "recent";

        /**
         * Atualiza estat√≠sticas do usu√°rio
         */
        const updateUserStats = () => {
          const stats = DataModule.calculateStats();

          const totalOrdersEl = UtilsModule.getElement("#totalOrders");
          const totalSpentEl = UtilsModule.getElement("#totalSpent");
          const averageOrderEl = UtilsModule.getElement("#averageOrder");

          if (totalOrdersEl) totalOrdersEl.textContent = stats.totalOrders;
          if (totalSpentEl)
            totalSpentEl.textContent = UtilsModule.formatCurrency(
              stats.totalSpent
            );
          if (averageOrderEl)
            averageOrderEl.textContent = UtilsModule.formatCurrency(
              stats.averageOrder
            );
        };

        /**
         * Atualiza contadores de abas
         */
        const updateTabCounts = () => {
          const counts = DataModule.countByStatus();

          const elements = {
            all: UtilsModule.getElement("#countAll"),
            pending: UtilsModule.getElement("#countPending"),
            confirmed: UtilsModule.getElement("#countConfirmed"),
            delivered: UtilsModule.getElement("#countDelivered"),
            cancelled: UtilsModule.getElement("#countCancelled"),
          };

          Object.entries(elements).forEach(([key, el]) => {
            if (el) el.textContent = counts[key];
          });
        };

        /**
         * Renderiza lista de pedidos
         * @param {Array} orders - Pedidos a renderizar
         */
        const renderOrders = (orders) => {
          const ordersList = UtilsModule.getElement("#ordersList");
          if (!ordersList) return;

          if (orders.length === 0) {
            ordersList.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <h3>Nenhum pedido encontrado</h3>
                    <p>Nenhum pedido corresponde aos filtros selecionados.</p>
                    <button class="btn-card" data-action="go-to-menu">
                        <i class="fas fa-utensils"></i>
                        Ver Card√°pio
                    </button>
                </div>
            `;
            return;
          }

          ordersList.innerHTML = orders
            .map((order) => createOrderCard(order))
            .join("");
        };

        /**
         * Cria card de pedido
         * @param {Object} order - Dados do pedido
         * @returns {string} HTML do card
         */
        const createOrderCard = (order) => {
          const statusColors = {
            pending: "warning",
            confirmed: "info",
            delivered: "success",
            cancelled: "error",
          };

          const statusIcons = {
            pending: "fas fa-clock",
            confirmed: "fas fa-check-circle",
            delivered: "fas fa-truck",
            cancelled: "fas fa-times-circle",
          };

          const statusColor = statusColors[order.status] || "info";
          const statusIcon = statusIcons[order.status] || "fas fa-info-circle";

          return `
            <div class="order-card">
                <div class="order-header">
                    <div class="order-id-date">
                        <h4 class="order-id">${UtilsModule.sanitizeText(
                          order.id
                        )}</h4>
                        <p class="order-date">
                            <i class="fas fa-calendar"></i>
                            ${UtilsModule.formatDate(order.date)} √†s ${
            order.time
          }
                        </p>
                    </div>
                    <div class="order-status status-${statusColor}">
                        <i class="${statusIcon}"></i>
                        <span>${UtilsModule.sanitizeText(
                          order.statusLabel
                        )}</span>
                    </div>
                </div>

                <div class="order-items-preview">
                    <div class="items-list">
                        ${order.items
                          .slice(0, 2)
                          .map(
                            (item) => `
                            <div class="item-preview">
                                <span class="item-qty">${item.quantity}x</span>
                                <span class="item-name">${UtilsModule.sanitizeText(
                                  item.name
                                )}</span>
                            </div>
                        `
                          )
                          .join("")}
                        ${
                          order.items.length > 2
                            ? `
                            <div class="items-more">
                                +${order.items.length - 2} item(ns)
                            </div>
                        `
                            : ""
                        }
                    </div>
                </div>

                <div class="order-footer">
                    <div class="order-total">
                        <span class="total-label">Total:</span>
                        <span class="total-value">${UtilsModule.formatCurrency(
                          order.total
                        )}</span>
                    </div>
                    <button class="btn-view-details" data-action="view-order-details" data-order-id="${
                      order.id
                    }">
                        <i class="fas fa-eye"></i>
                        Ver Detalhes
                    </button>
                </div>
            </div>
        `;
        };

        /**
         * Exibe detalhes do pedido em modal
         * @param {string} orderId - ID do pedido
         */
        const showOrderDetails = (orderId) => {
          const order = DataModule.getAllOrders().find((o) => o.id === orderId);
          if (!order) {
            NotificationModule.error("Pedido n√£o encontrado");
            return;
          }

          const detailsContent = UtilsModule.getElement("#orderDetailsContent");
          if (!detailsContent) return;

          const statusColors = {
            pending: "warning",
            confirmed: "info",
            delivered: "success",
            cancelled: "error",
          };

          const statusColor = statusColors[order.status] || "info";

          detailsContent.innerHTML = `
            <div class="order-details-grid">
                <!-- Informa√ß√µes Principais -->
                <div class="details-section">
                    <h4>Informa√ß√µes do Pedido</h4>
                    <div class="detail-item">
                        <span class="detail-label">N√∫mero:</span>
                        <span class="detail-value">${UtilsModule.sanitizeText(
                          order.id
                        )}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Data:</span>
                        <span class="detail-value">${UtilsModule.formatDate(
                          order.date
                        )} √†s ${order.time}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Status:</span>
                        <span class="detail-value status-badge status-${statusColor}">
                            <i class="fas fa-circle"></i>
                            ${UtilsModule.sanitizeText(order.statusLabel)}
                        </span>
                    </div>
                </div>

                <!-- Itens do Pedido -->
                <div class="details-section">
                    <h4>Itens do Pedido</h4>
                    <div class="items-table">
                        ${order.items
                          .map(
                            (item) => `
                            <div class="item-row">
                                <div class="item-info">
                                    <span class="item-qty">${
                                      item.quantity
                                    }x</span>
                                    <span class="item-name">${UtilsModule.sanitizeText(
                                      item.name
                                    )}</span>
                                </div>
                                <span class="item-price">${UtilsModule.formatCurrency(
                                  item.price * item.quantity
                                )}</span>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                </div>

                <!-- Entrega e Pagamento -->
                <div class="details-section">
                    <h4>Entrega e Pagamento</h4>
                    <div class="detail-item">
                        <span class="detail-label">Tipo de Entrega:</span>
                        <span class="detail-value">${UtilsModule.sanitizeText(
                          order.deliveryType
                        )}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Endere√ßo:</span>
                        <span class="detail-value">${UtilsModule.sanitizeText(
                          order.deliveryAddress
                        )}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">M√©todo de Pagamento:</span>
                        <span class="detail-value">${UtilsModule.sanitizeText(
                          order.paymentMethod
                        )}</span>
                    </div>
                </div>

                <!-- Resumo Financeiro -->
                <div class="details-section financial-summary">
                    <h4>Resumo Financeiro</h4>
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span>${UtilsModule.formatCurrency(
                          order.total * 0.95
                        )}</span>
                    </div>
                    <div class="summary-row">
                        <span>Taxa de Entrega:</span>
                        <span>${UtilsModule.formatCurrency(
                          order.total * 0.05
                        )}</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total:</span>
                        <span>${UtilsModule.formatCurrency(order.total)}</span>
                    </div>
                </div>

                <!-- Notas -->
                ${
                  order.notes
                    ? `
                    <div class="details-section">
                        <h4>Observa√ß√µes</h4>
                        <p class="order-notes">${UtilsModule.sanitizeText(
                          order.notes
                        )}</p>
                    </div>
                `
                    : ""
                }

                <!-- A√ß√µes -->
                <div class="details-section actions">
                    <button class="btn-action btn-action-primary" data-action="repeat-order" data-order-id="${
                      order.id
                    }">
                        <i class="fas fa-redo"></i>
                        Repetir Pedido
                    </button>
                    <button class="btn-action btn-action-secondary">
                        <i class="fas fa-download"></i>
                        Baixar Comprovante
                    </button>
                </div>
            </div>
        `;

          // Mostrar modal
          const modal = UtilsModule.getElement("#modalOrderDetails");
          if (modal) {
            modal.style.display = "flex";
            modal.setAttribute("aria-hidden", "false");
          }
        };

        /**
         * Ordena pedidos
         * @param {Array} orders - Pedidos a ordenar
         * @param {string} sortType - Tipo de ordena√ß√£o
         * @returns {Array} Pedidos ordenados
         */
        const sortOrders = (orders, sortType) => {
          const sorted = [...orders];

          switch (sortType) {
            case "recent":
              return sorted.sort((a, b) => new Date(b.date) - new Date(a.date));
            case "oldest":
              return sorted.sort((a, b) => new Date(a.date) - new Date(b.date));
            case "highest":
              return sorted.sort((a, b) => b.total - a.total);
            case "lowest":
              return sorted.sort((a, b) => a.total - b.total);
            default:
              return sorted;
          }
        };

        /**
         * Aplica filtros e renderiza pedidos
         */
        const applyFilters = () => {
          let orders = DataModule.getOrdersByStatus(currentFilter);
          orders = sortOrders(orders, currentSort);
          renderOrders(orders);
        };

        // API p√∫blica
        return {
          updateUserStats,
          updateTabCounts,
          renderOrders,
          showOrderDetails,
          applyFilters,

          // Getters e Setters
          get currentFilter() {
            return currentFilter;
          },
          set currentFilter(value) {
            currentFilter = value;
          },

          get currentSort() {
            return currentSort;
          },
          set currentSort(value) {
            currentSort = value;
          },
        };
      })();

      // ==================== M√ìDULO PRINCIPAL ====================
      const App = (() => {
        "use strict";

        /**
         * Gerenciador central de eventos
         * @param {Event} event - Evento capturado
         */
        const handleGlobalClick = (event) => {
          const target = event.target.closest("[data-action]");
          if (!target) return;

          const action = target.dataset.action;
          event.preventDefault();

          // Roteamento de a√ß√µes
          switch (action) {
            case "navigate-back":
              window.location.href = "index.html";
              break;

            case "view-order-details":
              const orderId = target.dataset.orderId;
              if (orderId) {
                UIModule.showOrderDetails(orderId);
              }
              break;

            case "close-order-modal":
              closeOrderModal();
              break;

            case "go-to-menu":
              window.location.href = "cardapio.html";
              break;

            case "repeat-order":
              const repeatOrderId = target.dataset.orderId;
              if (repeatOrderId) {
                NotificationModule.success("Pedido adicionado ao carrinho!");
                setTimeout(() => {
                  window.location.href = "cardapio.html";
                }, 1500);
              }
              break;

            default:
              console.warn(`A√ß√£o n√£o reconhecida: ${action}`);
          }
        };

        /**
         * Fecha modal de detalhes
         */
        const closeOrderModal = () => {
          const modal = UtilsModule.getElement("#modalOrderDetails");
          if (modal) {
            modal.style.display = "none";
            modal.setAttribute("aria-hidden", "true");
          }
        };

        /**
         * Gerencia cliques nas abas de status
         * @param {Event} event - Evento de clique
         */
        const handleStatusTabClick = (event) => {
          const tab = event.target.closest(".status-tab");
          if (!tab) return;

          // Remover ativo de todas as abas
          document
            .querySelectorAll(".status-tab")
            .forEach((t) => t.classList.remove("active"));

          // Adicionar ativo √† aba clicada
          tab.classList.add("active");

          // Atualizar filtro
          const filter = tab.dataset.filter;
          UIModule.currentFilter = filter;
          UIModule.applyFilters();
        };

        /**
         * Gerencia busca de pedidos
         * @param {Event} event - Evento de input
         */
        const handleSearch = UtilsModule.debounce((event) => {
          const query = event.target.value.trim();

          if (query === "") {
            UIModule.applyFilters();
          } else {
            const results = DataModule.searchOrders(query);
            UIModule.renderOrders(results);
          }
        }, 300);

        /**
         * Gerencia ordena√ß√£o de pedidos
         * @param {Event} event - Evento de mudan√ßa
         */
        const handleSortChange = (event) => {
          UIModule.currentSort = event.target.value;
          UIModule.applyFilters();
        };

        /**
         * Fecha modal ao clicar no backdrop
         * @param {Event} event - Evento de clique
         */
        const handleModalBackdropClick = (event) => {
          if (event.target.classList.contains("modal")) {
            event.target.style.display = "none";
            event.target.setAttribute("aria-hidden", "true");
          }
        };

        /**
         * Inicializa a aplica√ß√£o
         */
        const init = () => {
          try {
            // Atualizar dados
            UIModule.updateUserStats();
            UIModule.updateTabCounts();
            UIModule.applyFilters();

            // Eventos globais
            document.addEventListener("click", handleGlobalClick);

            // Eventos de filtros
            const statusTabs = document.querySelectorAll(".status-tab");
            statusTabs.forEach((tab) => {
              tab.addEventListener("click", handleStatusTabClick);
            });

            // Evento de busca
            const searchInput = UtilsModule.getElement("#searchInput");
            if (searchInput) {
              searchInput.addEventListener("input", handleSearch);
            }

            // Evento de ordena√ß√£o
            const sortSelect = UtilsModule.getElement("#sortSelect");
            if (sortSelect) {
              sortSelect.addEventListener("change", handleSortChange);
            }

            // Fechar modal ao clicar no backdrop
            document.querySelectorAll(".modal").forEach((modal) => {
              modal.addEventListener("click", handleModalBackdropClick);
            });

            console.log("üöÄ Sistema de Meus Pedidos inicializado com sucesso!");
            NotificationModule.success("Sistema carregado com sucesso!", 2000);
          } catch (error) {
            console.error("‚ùå Erro na inicializa√ß√£o:", error);
            NotificationModule.error(
              "Erro ao carregar o sistema. Tente recarregar a p√°gina."
            );
          }
        };

        // API p√∫blica
        return {
          init,
        };
      })();

      // ==================== INICIALIZA√á√ÉO ====================
      document.addEventListener("DOMContentLoaded", App.init);

      // Exportar m√≥dulos para debug (apenas em desenvolvimento)
      if (
        typeof window !== "undefined" &&
        window.location.hostname === "localhost"
      ) {
        window.DebugModules = {
          Data: DataModule,
          Utils: UtilsModule,
          Notification: NotificationModule,
          UI: UIModule,
          App,
        };
      }
    </script>
  </body>
</html>
